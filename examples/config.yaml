# VSG Configuration Example
# This file demonstrates all available configuration options

# Vault connection settings
vault:
  address: https://vault.example.com
  # namespace: admin  # Vault Enterprise namespace (optional)

  # Authentication method: token, kubernetes, or approle
  auth:
    method: kubernetes
    role: secret-sync
    # mount_path: kubernetes  # Custom auth mount path (optional)

    # For token auth:
    # method: token
    # token: hvs.xxxxx  # Or use VAULT_TOKEN env var

    # For approle auth:
    # method: approle
    # role_id: xxxxx
    # secret_id: xxxxx

# Default password generation policy
# These defaults apply to all 'generate' values unless overridden
defaults:
  generate:
    length: 32
    digits: 5
    symbols: 5
    symbolCharacters: "-_$@"
    noUpper: false
    allowRepeat: true

# Secrets definitions grouped by Vault path
secrets:
  # Database secrets
  database:
    path: kv/prod/database
    data:
      # From Terraform state - S3 backend with JSON extraction
      host:
        source: s3://terraform-state/prod/rds/terraform.tfstate
        json: .outputs.endpoint.value

      port:
        source: s3://terraform-state/prod/rds/terraform.tfstate
        json: .outputs.port.value

      username:
        source: s3://terraform-state/prod/rds/terraform.tfstate
        json: .outputs.master_username.value

      password: generate

  # Application secrets
  app:
    path: kv/prod/app
    data:
      # From local file with YAML extraction
      db_name:
        source: file:///etc/app/config.yaml
        yaml: .database.name

      # Generated passwords - use defaults
      api_key: generate

      # Generated with custom policy
      jwt_secret:
        generate:
          length: 64

      webhook_token:
        generate:
          length: 48
          symbols: 0

      # From command execution
      password_hash:
        command: caddy hash-password --plaintext "secret123"

      # Static values
      environment: "production"
      version: "1.2.3"

  # Docker registry secrets
  docker:
    path: kv/prod/docker
    data:
      registry_url:
        source: s3://terraform-state/prod/ecr/terraform.tfstate
        json: .outputs.registry_url.value

      registry_token:
        generate:
          length: 64
          symbols: 0

  # Legacy KV v1 secrets
  legacy:
    path: kv/legacy
    version: 1
    data:
      token:
        generate:
          length: 24
          symbols: 0
